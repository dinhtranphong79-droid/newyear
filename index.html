<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Happy New Year 2026</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  background: black;
  overflow: hidden;
}
canvas {
  display: block;
  width: 100%;
  height: 100%;
}
</style>
</head>
<body>

<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

let W, H;
function resize() {
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

const rand = (a,b)=>Math.random()*(b-a)+a;

class Particle {
  constructor(x, y, vx, vy, color, life=50, size=2) {
    this.x = x;
    this.y = y;
    this.vx = vx;
    this.vy = vy;
    this.color = color;
    this.life = life;
    this.size = size;
  }

  update() {
    this.x += this.vx;
    this.y += this.vy;
    this.vy += 0.05; // trọng lực nhẹ
    this.size *= 0.96; // co dần
    this.life--;
  }

  draw() {
    ctx.fillStyle = this.color;
    ctx.fillRect(this.x, this.y, this.size, this.size);
  }
}

let particles = [];

// ======================
// PHÁO HOA HÌNH DẠNG
// ======================
function explode(x, y, type="circle") {
  const color = `hsl(${rand(0,360)},100%,60%)`;
  const count = 50 + Math.floor(rand(0,30));

  for(let i=0;i<count;i++){
    let angle = 0, vx=0, vy=0;
    if(type==="circle"){
      angle = (i/count)*Math.PI*2;
      vx = Math.cos(angle)*rand(2,6);
      vy = Math.sin(angle)*rand(2,6);
    } else if(type==="star"){
      angle = (i%5)*(Math.PI*2/5) + Math.random()*0.5;
      let r = rand(3,6);
      vx = Math.cos(angle)*r;
      vy = Math.sin(angle)*r;
    } else if(type==="heart"){
      let t = (i/count)*2*Math.PI;
      vx = 8*(16*Math.pow(Math.sin(t),3))/50;
      vy = -8*(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t))/50;
      vx += rand(-0.5,0.5);
      vy += rand(-0.5,0.5);
    }
    particles.push(new Particle(x, y, vx, vy, color, 50+Math.floor(rand(0,30)), 2+rand(0,2)));
  }
}

// ======================
// PHÁO HOA BAN ĐẦU
// ======================
function launchFirework() {
  const x = rand(W*0.2, W*0.8);
  const y = H + 50;
  const typeArray = ["circle","star","heart"];
  const type = typeArray[Math.floor(rand(0,typeArray.length))];
  const peakY = rand(H*0.3,H*0.6);

  // particle bay lên
  const p = new Particle(x, y, 0, rand(-7,-10), `hsl(${rand(0,360)},100%,60%)`, 100, 3);
  particles.push(p);

  // nổ tại đỉnh
  setTimeout(()=>{
    explode(x, peakY, type);
  }, 700 + rand(0,400));
}

let fireworkInterval = setInterval(launchFirework, 800);

// ======================
// CHỮ “HAPPY NEW YEAR 2026”
// ======================
function createTextFirework(text, yRatio, size) {
  const off = document.createElement("canvas");
  const octx = off.getContext("2d");
  off.width = W;
  off.height = H;

  octx.fillStyle = "#fff";
  octx.textAlign = "center";
  octx.textBaseline = "middle";
  octx.font = `900 ${size}px Arial`;
  octx.fillText(text, W/2, H*yRatio);

  const img = octx.getImageData(0,0,W,H).data;

  for(let y=0; y<H; y+=6){
    for(let x=0; x<W; x+=6){
      const i = (y*W + x)*4;
      if(img[i+3] > 150){
        // bắn từ dưới lên
        const color = `hsl(${rand(0,360)},100%,60%)`;
        const p = new Particle(x, H+rand(50,200), 0, rand(-12,-9), color, 60, 2);
        particles.push(p);
        // tạo sparkle khi đến vị trí
        setTimeout(()=>explode(x, y, "circle"), 500);
      }
    }
  }
}

// chữ xuất hiện sau 15 giây
setTimeout(()=>{
  createTextFirework("HAPPY NEW YEAR", 0.28, W*0.085);
}, 15000);

setTimeout(()=>{
  createTextFirework("2026", 0.42, W*0.2);
}, 16500);

// dừng pháo hoa ban đầu sau khi chữ xuất hiện
setTimeout(()=>{
  clearInterval(fireworkInterval);
}, 16500);

// ======================
// ANIMATE LOOP
// ======================
function animate() {
  ctx.fillStyle = "rgba(0,0,0,0.2)";
  ctx.fillRect(0,0,W,H);

  particles.forEach(p=>{
    p.update();
    p.draw();
  });

  particles = particles.filter(p=>p.size>0.5 && p.life>0);
  requestAnimationFrame(animate);
}
animate();
</script>

</body>
</html>
