<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Happy New Year 2026</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  background: black;
  overflow: hidden;
}
canvas {
  display: block;
  width: 100%;
  height: 100%;
}
</style>
</head>
<body>

<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

let W, H;
function resize() {
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

const rand = (a,b)=>Math.random()*(b-a)+a;

class Particle {
  constructor(x, y, vx, vy, color, life=50, size=2, type="spark") {
    this.x = x;
    this.y = y;
    this.vx = vx;
    this.vy = vy;
    this.color = color;
    this.life = life;
    this.size = size;
    this.type = type; // "rocket" | "spark"
  }

  update() {
    if(this.type==="rocket"){
      this.y += this.vy;
      this.vy += 0.1; // trọng lực nhẹ
      this.life--;
    } else {
      this.x += this.vx;
      this.y += this.vy;
      this.vy += 0.05;
      this.size *= 0.96;
      this.life--;
    }
  }

  draw(ctx) {
    ctx.fillStyle = this.color;
    ctx.fillRect(this.x, this.y, this.size, this.size);
  }
}

let particles = [];

// ======================
// PHÁO HOA NỔ HÌNH DẠNG
// ======================
function explode(x, y, type="circle") {
  const color = `hsl(${rand(0,360)},100%,60%)`;
  const count = 60 + Math.floor(rand(0,40)); // nhiều hơn
  for(let i=0;i<count;i++){
    let angle=0, vx=0, vy=0;
    if(type==="circle"){
      angle = (i/count)*Math.PI*2;
      vx = Math.cos(angle)*rand(2,6);
      vy = Math.sin(angle)*rand(2,6);
    } else if(type==="star"){
      angle = (i%5)*(Math.PI*2/5) + Math.random()*0.5;
      let r = rand(3,6);
      vx = Math.cos(angle)*r;
      vy = Math.sin(angle)*r;
    } else if(type==="heart"){
      let t = (i/count)*2*Math.PI;
      vx = 8*(16*Math.pow(Math.sin(t),3))/50;
      vy = -8*(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t))/50;
      vx += rand(-0.5,0.5);
      vy += rand(-0.5,0.5);
    }
    particles.push(new Particle(x, y, vx, vy, color, 50+Math.floor(rand(0,30)), 2+rand(0,2), "spark"));
  }
}

// ======================
// BẮN PHÁO HOA DÀY ĐẶC
// ======================
function launchFireworksDense() {
  const rocketsPerFrame = 3; // nhiều rocket mỗi lần
  for(let j=0;j<rocketsPerFrame;j++){
    const x = rand(W*0.1, W*0.9);
    const y = H + 50;
    const peakY = rand(H*0.2, H*0.6);
    const typeArray = ["circle","star","heart"];
    const type = typeArray[Math.floor(rand(0,typeArray.length))];

    const rocket = new Particle(x, y, 0, rand(-7,-10), `hsl(${rand(0,360)},100%,60%)`, 100, 3, "rocket");
    rocket.peakY = peakY;
    rocket.explodeType = type;
    particles.push(rocket);
  }
}

// xử lý rocket đạt đỉnh → nổ
function handleRockets() {
  particles.forEach(p=>{
    if(p.type==="rocket" && p.y <= p.peakY){
      explode(p.x, p.y, p.explodeType);
      p.life = 0;
    }
  });
}

// ======================
// CHỮ HAPPY NEW YEAR 2026 (giữ nguyên)
// ======================
let textCanvas = document.createElement("canvas");
let textCtx = textCanvas.getContext("2d");
textCanvas.width = W;
textCanvas.height = H;

function createText(text, yRatio, size){
  textCtx.clearRect(0,0,W,H);
  textCtx.fillStyle = "white";
  textCtx.textAlign = "center";
  textCtx.textBaseline = "middle";
  textCtx.font = `900 ${size}px Arial`;
  textCtx.fillText(text, W/2, H*yRatio);
}

// chữ xuất hiện sau 15s
setTimeout(()=>{ createText("HAPPY NEW YEAR", 0.28, W*0.085); }, 15000);
setTimeout(()=>{ createText("HAPPY NEW YEAR 2026", 0.28, W*0.085); }, 16500);

// ======================
// ANIMATE LOOP
// ======================
let fireworkInterval = setInterval(launchFireworksDense, 400); // dày đặc hơn
setTimeout(()=>{ clearInterval(fireworkInterval); }, 16500);

function animate(){
  // làm mờ particle cũ nhưng giữ chữ
  ctx.fillStyle = "rgba(0,0,0,0.2)";
  ctx.fillRect(0,0,W,H);

  // vẽ chữ lên trước
  ctx.drawImage(textCanvas,0,0);

  handleRockets();

  particles.forEach(p=>{
    p.update();
    p.draw(ctx);
  });

  particles = particles.filter(p=>p.life>0 && p.size>0.5);

  requestAnimationFrame(animate);
}
animate();
</script>

</body>
</html>
